<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="css/styles.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <script src="https://kit.fontawesome.com/9479635e2b.js"></script>
  <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
    integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  
  <title></title>
</head>
<body>
    <div class="main_content">

        <div class="progressWrapper text-center">
            <div id="progressDiv_1" class="glowBorder">
              <div id="progress_1"></div>
            </div>
            <div id="progressDiv_2">
              <div id="progress_2"></div>
            </div>
            <div id="progressDiv_3">
              <div id="progress_3"></div>
            </div>
            <div id="progressDiv_4">
              <div id="progress_4"></div>
            </div>
          </div>

      <div class="upitnik_wrapper">
        <div class="pitanjaDiv text-center"></div>

      </div>

      <div class="product_wrapper border border-primary hide">
        <div class="block1 text-center">
          <h1>Preporuceni proizvodi</h1>
        </div>
        <div class="productsDiv">
          <div class="products justify-content-center">

          </div>
        </div>

        <div class="block2 text-center">
          <h1>Ostali proizvodi</h1>
        </div>
        <div class="otherProductsDiv">
          <div class="other_products justify-content-center border border-primary">
            
          </div>
        </div>
      </div>
              
        
      
      

    </div>


<script type="application/javascript">

  window.onload = function() { 

//****************************************************************HTML STRINGS***************************************************************************************************
    var HTML = function () {
      return {
        1: `<div class="pitanjaDiv">
              <div id="strana_1" class="row border border-primary">
                <div class="col-sm text-center border border-primary p-4">
                  <button id="btn_1_1" type="button" class="btn btn-primary" value="next" data-goto="${page}">5-10 godina</button>
                </div>

                <div class="col-sm text-center border border-primary p-4">
                  <button id="btn_1_2" type="button" class="btn btn-primary" value="next" data-goto="${page}">10-50 godina</button>
                </div>
                  
                <div id="3" class="col-sm text-center border border-primary p-4">
                  <button id="btn_1_3" type="button" class="btn btn-primary" value="next" data-goto="${page}">50+ godina</button>
                </div>
              </div>
            </div>`,
        
        2: `<div class="pitanjaDiv">
              <div id="strana_2" class="row border border-primary">
                <div class="col-sm text-center border border-primary p-4">
                  <button id="btn_2_1" type="button" class="btn btn-primary" value="next" data-goto="${page}">Ne treniram</button>
                </div>
              
                <div class="col-sm text-center border border-primary p-4">
                  <button id="btn_2_2" type="button" class="btn btn-primary" value="next" data-goto="${page}">Ponekad treniram</button>
                </div>
              
                <div class="col-sm text-center border border-primary p-4">
                  <button id="btn_2_3" type="button" class="btn btn-primary" value="next" data-goto="${page}">Aktivno treniram</button>
                </div>
              </div>
              <button id="prev" type="button" class="btn btn-primary" data-goto="${page}">Nazad</button>
            </div>`,

        3: `<div class="pitanjaDiv">
              <div id="strana_3" class="row border border-primary">
                <div class="col-sm text-center border border-primary p-4">
                  <button id="btn_3_1" type="button" class="btn btn-primary" value="next" data-goto="${page}">Musko</button>
                </div>
              
                <div class="col-sm text-center border border-primary p-4">
                  <button id="btn_3_2" type="button" class="btn btn-primary" value="next" data-goto="${page}">Zensko</button>
                </div>
              
                <div class="col-sm text-center border border-primary p-4">
                  <button id="btn_3_3" type="button" class="btn btn-primary" value="next" data-goto="${page}">Nesto izmedju :)</button>
                </div>
              </div>
              <button id="prev" type="button" class="btn btn-primary" data-goto="${page}">Nazad</button>
            </div>`,

        4: `<form class="checkboxForm" action="#">
            <table class="table table-bordered">
            <tbody>

              <tr class="text-center border-primary">
                <td class="text-center border-primary">
                  <img src="./img/karakteristike/cardio-ikona-kontrola-stresa1.png">
                  <p>kontrola stresa</p>
                  <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="kontrola_stresa" data-check="4">
                    <label class="custom-control-label" for="kontrola_stresa">Check this custom checkbox</label>
                  </div>
                </td>

                <td class="text-center border-primary">
                <img src="./img/karakteristike/direct-ikona-kosti1.png">
                <p>kosti</p>
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="kosti" data-check="3">
                  <label class="custom-control-label" for="kosti">Check this custom checkbox</label>
                </div>
                </td>

                <td class="text-center border-primary">
                <img src="./img/karakteristike/imuno-ikona-imunitet.png">
                <p>imunitet </p>
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="imunitet" data-check="5">
                  <label class="custom-control-label" for="imunitet">Check this custom checkbox</label>
                </div>
                </td>
              </tr>

              <tr class="text-center border-primary">
                <td class="text-center border-primary">
                  <img src="./img/karakteristike/mineral-ikona-energija.png">
                  <p>energija</p>
                  <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="energija" data-check="0">
                    <label class="custom-control-label" for="energija">Check this custom checkbox</label>
                  </div>
                </td>

                <td class="text-center border-primary">
                <img src="./img/karakteristike/magnal-1.png" style="height: 65px; background-color: blue; top:50%; transform: translateY(50%)">
                </td>

                <td class="text-center border-primary">
                <img src="./img/karakteristike/mineral-ikona-misici.png">
                <p>misici </p>
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="misici" data-check="1">
                  <label class="custom-control-label" for="misici">Check this custom checkbox</label>
                </div>
                </td>
              </tr>
              
              <tr class="text-center ">
                <td class="text-center border-primary">
                  <img src="./img/karakteristike/mineral-ikona-nervni-sistem.png">
                  <p>nervni sistem </p>
                  <div class="custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input" id="nervni_sistem" data-check="2">
                    <label class="custom-control-label" for="nervni_sistem">Check this custom checkbox</label>
                  </div>
                </td>

                <td class="text-center border-primary">
               
                </td>

                <td class="text-center border-primary">
                <img src="./img/karakteristike/sleep-ikona-metabolizam.png">
                <p>metabolizam </p>
                <div class="custom-control custom-checkbox">
                  <input type="checkbox" class="custom-control-input" id="metabolizam" data-check="6">
                  <label class="custom-control-label" for="metabolizam">Check this custom checkbox</label>
                </div>
                </td>
              </tr>

            </tbody>
          </table>
          </br>
          <div class="text-center">
          <button id="submit" type="button" class="btn btn-primary" value="submit">Submit</button>
          </div>
          </form>`,
        proizvod_1: `<div id="proizvod_1" class="card">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_1.jpg" alt="proizvod 1 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 1</h5>
                        <p class="card-text">Ovo je proizvod 1 i mnogo je dobar</p>
                        <a href="#" class="btn btn-primary">Detaljnije</a>
                      </div>
                    </div>`,
        proizvod_2: `<div id="proizvod_2" class="card" >
                      <img class="card-img-top" src="./img/proizvodi/proizvod_2.jpg" alt="proizvod 2 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 2</h5>
                        <p class="card-text">Ovo je proizvod 2 i mnogo je dobar</p>
                        <a href="#" class="btn btn-primary">Detaljnije</a>
                      </div>
                    </div>`,
        proizvod_3: `<div id="proizvod_3" class="card">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_3.jpg" alt="proizvod 3 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 3</h5>
                        <p class="card-text">Ovo je proizvod 3 i mnogo je dobar</p>
                        <a href="#" class="btn btn-primary">Detaljnije</a>
                      </div>
                    </div>`,
        proizvod_4: `<div id="proizvod_4" class="card">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_4.jpg" alt="proizvod 4 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 4</h5>
                        <p class="card-text">Ovo je proizvod 4 i mnogo je dobar</p>
                        <a href="#" class="btn btn-primary">Detaljnije</a>
                      </div>
                    </div>`,
        proizvod_5: `<div id="proizvod_5" class="card">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_5.jpg" alt="proizvod 4 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 5</h5>
                        <p class="card-text">Ovo je proizvod 5 i mnogo je dobar</p>
                        <a href="#" class="btn btn-primary">Detaljnije</a>
                      </div>
                    </div>`,
        proizvod_6: `<div id="proizvod_6" class="card">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_6.jpg" alt="proizvod 6 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 6</h5>
                        <p class="card-text">Ovo je proizvod 6 i mnogo je dobar</p>
                        <a href="#" class="btn btn-primary">Detaljnije</a>
                      </div>
                    </div>`,
        ostaliProizvod_1: `<div id="proizvod_1" class="card" style="width: 10em; height: 10em">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_1.jpg" alt="proizvod 1 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 1</h5>
                      </div>
                    </div>`,
        ostaliProizvod_2: `<div id="proizvod_2" class="card" style="width: 10em; height: 10em">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_2.jpg" alt="proizvod 2 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 2</h5>
                      </div>
                    </div>`,
        ostaliProizvod_3: `<div id="proizvod_3" class="card" style="width: 10em; height: 10em">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_3.jpg" alt="proizvod 3 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 3</h5>
                      </div>
                    </div>`,
        ostaliProizvod_4: `<div id="proizvod_4" class="card" style="width: 10em; height: 10em">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_4.jpg" alt="proizvod 4 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 4</h5>
                      </div>
                    </div>`,
        ostaliProizvod_5: `<div id="proizvod_5" class="card" style="width: 10em; height: 10em">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_5.jpg" alt="proizvod 5 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 4</h5>
                      </div>
                    </div>`,
        ostaliProizvod_6: `<div id="proizvod_6" class="card" style="width: 10em; height: 10em">
                      <img class="card-img-top" src="./img/proizvodi/proizvod_6.jpg" alt="proizvod 6 slika">
                      <div class="card-body">
                        <h5 class="card-title">Proizvod 6</h5>
                      </div>
                    </div>`,
      }
    }
//***********************************



//********************Initialization************************************************
    // DOM Elements
    var DOM = {
      upitnik_wrapper : document.querySelector('.upitnik_wrapper'),
      product_wrapper : document.querySelector('.product_wrapper'),
      other_products : document.querySelector('.other_products'),
      product : document.querySelector('.product'),
      products : document.querySelector('.products'),
      block1 : document.querySelector('.block1'),
      block2: document.querySelector('.block2'),
    };

    // Initialization
    var page = 1;
    var answersArr = [];
    var checkedValues = [];
    var products = {
      proizvod_1: ['energija', 'misici', 'nervni_sistem', 'kosti'],
      proizvod_2: ['nervni_sistem', 'kontrola_stresa', 'energija', 'misici'],
      proizvod_3: ['nervni_sistem', 'kontrola_stresa', 'energija', 'misici'],
      proizvod_4: ['imunitet', 'energija', 'misici'],
      proizvod_5: ['energija', 'misici', 'metabolizam', 'nervni_sistem'],
      proizvod_6: ['metabolizam', 'energija', 'misici', 'nervni_sistem'],
    }
    var uncheckList = [
      [''],
      [''],
      ['imunitet'],
      ['kontrola_stresa', 'imunitet', 'metabolizam'],
      ['kosti', 'imunitet', 'metabolizam'],
      ['nervni_sistem', 'kosti', 'kontrola_stresa', 'metabolizam'],
      ['energija', 'kontrola_stresa', 'nervni_sistem', 'kosti']
    ]
    var matchingProducts = {
        proizvod_1 : [],
        proizvod_2 : [],
        proizvod_3 : [],
        proizvod_4: [],
        proizvod_5: [],
        proizvod_6: [],
      };
    var sortByLength = new Array;

//********************************




//*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?*?

















//?*?*?*?*?*?*?*?**?*?*?*??*?*?*?**??*?*?*?*?*?**??*?*?*?*?*?*?*?*?












//************************RENDER PAGES************************************************
    // on load show first page
    DOM.upitnik_wrapper.innerHTML = HTML()[page];

    // show next page
    function showNextPage() {
        page++;
        DOM.upitnik_wrapper.innerHTML = HTML()[page];
    }

    // show previous page
    function showPrevPage() {
      page--;
      DOM.upitnik_wrapper.innerHTML = HTML()[page];
    }


//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////


    function loadProgress() {
      var progressBar = document.getElementById(`progress_${page - 1}`); 
      var width = 1;
      var id = setInterval(bar, 1);
      function bar() {
        if (width >= 100) {
          clearInterval(id);
        } else {
          width++; 
          progressBar.style.width = width + '%'; 
        }
      }
    }
    function unloadProgress() {
      var progressBar = document.getElementById(`progress_${page}`);
      var width = 100;
      var id = setInterval(bar, 1);
      function bar() {
        if (width <= 0) {
          clearInterval(id);
        } else {
          width--; 
          progressBar.style.width = width + '%'; 
        }
      }
    }
    function addGlowBorder() {
      var currentBar = document.getElementById(`progressDiv_${page}`);
      var barBefore = document.getElementById(`progressDiv_${page - 1}`);
      var barNext = document.getElementById(`progressDiv_${page + 1}`);
      var clear = setInterval(current, 350);

      function current() {
        currentBar.classList.add('glowBorder');
        clearInterval(clear);
        barBefore.classList.remove('glowBorder');
      }
    }
    function removeGlowBorder() {
      var barNext = document.getElementById(`progressDiv_${page + 1}`);
      var currentBar = document.getElementById(`progressDiv_${page}`);
      barNext.classList.remove('glowBorder');
      currentBar.classList.add('glowBorder');
    }
    

/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////   


//********************************

    

//***************************SAVE, DELETE, PUSH, MATCH********************************
    // save answer on user input
    function saveAnswer() {
      var answer = event.target.id.split('_')[2];
      answersArr.push(answer);
    }

    // delete last answer on prev button
    function deleteAnswer() {
      answersArr.pop();
    }

    // adds checked answers to array //for showProduct function
    function saveCheckedValues() {
      var form = event.target.form;
      for (var i = 0; i < form.length; i++) {
        if (form[i].checked) {
          var checkedBoxName = form[i].id;
          checkedValues.push(checkedBoxName);
        }
      }
    }

    // Push matching answers to matchingProducts
    function pushMatchingAnswers(checkedAnswersArr, proizvod1Arr, proizvod2Arr, proizvod3Arr, proizvod4Arr, proizvod5Arr, proizvod6Arr) {
      checkedAnswersArr.forEach( (e1) => proizvod1Arr.forEach( (e2) => proizvod2Arr.forEach((e3) => proizvod3Arr.forEach((e4) => proizvod4Arr.forEach((e5) => proizvod5Arr.forEach((e6) => proizvod6Arr.forEach((e7) => {
        if(e1 === e2) {
          matchingProducts.proizvod_1.indexOf(e2) === -1 ? matchingProducts.proizvod_1.push(e2) : '';
        }

        if(e1 === e3) {
          matchingProducts.proizvod_2.indexOf(e3) === -1 ? matchingProducts.proizvod_2.push(e3) : '';
        }

        if(e1 === e4) {
          matchingProducts.proizvod_3.indexOf(e4) === -1 ? matchingProducts.proizvod_3.push(e4) : '';
        }
        if (e1 === e5) {
          matchingProducts.proizvod_4.indexOf(e5) === -1 ? matchingProducts.proizvod_4.push(e5) : '';
        }
        if (e1 === e6) {
          matchingProducts.proizvod_5.indexOf(e6) === -1 ? matchingProducts.proizvod_5.push(e6) : '';
        }
        if (e1 === e7) {
          matchingProducts.proizvod_6.indexOf(e7) === -1 ? matchingProducts.proizvod_6.push(e7) : '';
        }

      } )))))));
    }
      
    // Push matched answers from user input
    function sortProducts() {
      var proizvod1Length = matchingProducts.proizvod_1.length;
      var proizvod2Length = matchingProducts.proizvod_2.length;
      var proizvod3Length = matchingProducts.proizvod_3.length;
      var proizvod4Length = matchingProducts.proizvod_4.length;
      var proizvod5Length = matchingProducts.proizvod_5.length;
      var proizvod6Length = matchingProducts.proizvod_6.length;




      sortByLength['proizvod_1'] = proizvod1Length;
      sortByLength['proizvod_2'] = proizvod2Length;
      sortByLength['proizvod_3'] = proizvod3Length;
      sortByLength['proizvod_4'] = proizvod4Length;
      sortByLength['proizvod_5'] = proizvod5Length;
      sortByLength['proizvod_6'] = proizvod6Length;

    }

    // Find best match for the given answers
    function closest(array, num) {
      var i = 0;
      var minDiff = 1000;
      var ans;
      for (i in array) {
        var m = Math.abs(num - array[i]);
        if (m < minDiff) {
          minDiff = m;
          ans = array[i];
        }
      }

      return ans;
    }

//*******************************



//************************DISABLE CHECKBOXES******************************************************************
function disableCheckboxes() {
  var el = event.target;
  var checkboxNum = parseInt(event.target.dataset.check);
  uncheckList[checkboxNum].forEach(function(element) {
    if(element != '') {
      if(el.checked) {
        document.getElementById(element).parentElement.parentElement.classList.add("disable");
        document.getElementById(element).disabled = true;
      } else {
        document.getElementById(element).parentElement.parentElement.classList.remove("disable");
        document.getElementById(element).disabled = false;
      }
    }
  })
  
}
//*************************************************************************************************************


//********************SHOW MATCHED PRODUCTS********************************************************************
    

    // Show products on page
    function showProducts() {
      DOM.upitnik_wrapper.outerHTML = "";
      
      /* DOM.block1.classList.add("show");
      DOM.block1.classList.remove("hide"); */
      DOM.product_wrapper.classList.add("show");
      DOM.product_wrapper.classList.remove("hide");
      
      /* DOM.block2.classList.add("show");
      DOM.block2.classList.remove("hide"); */
      
      
      if (sortByLength['proizvod_1'] == closest(sortByLength, 10)) {
        //insert into mian wrapper 
        DOM.products.insertAdjacentHTML('afterbegin', HTML().proizvod_1);
        
      } else {
        //insert into other products
        DOM.other_products.insertAdjacentHTML('afterbegin', HTML().ostaliProizvod_1);
      }
      if (sortByLength['proizvod_2'] == closest(sortByLength, 10)) {
        //insert into main wrapper
        DOM.products.insertAdjacentHTML('afterbegin', HTML().proizvod_2);

      } else {
        //insert into other products
        DOM.other_products.insertAdjacentHTML('afterbegin', HTML().ostaliProizvod_2);
      }
      if (sortByLength['proizvod_3'] == closest(sortByLength, 10)) {
        //insert into main wrapper 
        DOM.products.insertAdjacentHTML('afterbegin', HTML().proizvod_3);

      } else {
        //insert into other products
        DOM.other_products.insertAdjacentHTML('afterbegin', HTML().ostaliProizvod_3);
      }
      if (sortByLength['proizvod_4'] == closest(sortByLength, 10)) {
        //insert into mian wrapper 
        DOM.products.insertAdjacentHTML('afterbegin', HTML().proizvod_4);

      } else {
        //insert into other products
        DOM.other_products.insertAdjacentHTML('afterbegin', HTML().ostaliProizvod_4);
      }
      if (sortByLength['proizvod_5'] == closest(sortByLength, 10)) {
        //insert into mian wrapper 
        DOM.products.insertAdjacentHTML('afterbegin', HTML().proizvod_5);

      } else {
        //insert into other products
        DOM.other_products.insertAdjacentHTML('afterbegin', HTML().ostaliProizvod_5);
      }
      if (sortByLength['proizvod_6'] == closest(sortByLength, 10)) {
        //insert into mian wrapper 
        DOM.products.insertAdjacentHTML('afterbegin', HTML().proizvod_6);

      } else {
        //insert into other products
        DOM.other_products.insertAdjacentHTML('afterbegin', HTML().ostaliProizvod_6);
      }
    }

//*****************************************



//**********************************************iNPUT LISTENER*******************************************************
    // user input listener
    DOM.upitnik_wrapper.addEventListener('click', function(event) {
      if (event.target.value == 'next') {
        showNextPage();
        saveAnswer();
        loadProgress();
        addGlowBorder();
      }
      if (event.target.id == 'prev') {
        deleteAnswer();
        showPrevPage();
        unloadProgress();
        removeGlowBorder();
      }
      if(event.target.id == 'submit') {
        page++;
        saveCheckedValues();
        pushMatchingAnswers(checkedValues, products.proizvod_1, products.proizvod_2, products.proizvod_3, products.proizvod_4, products.proizvod_5, products.proizvod_6);
        sortProducts();
        showProducts();
        loadProgress();
      }
      if(event.target.type == 'checkbox') {
        disableCheckboxes();
      }
    });

//*****************************************



};

</script>

</body>
</html>